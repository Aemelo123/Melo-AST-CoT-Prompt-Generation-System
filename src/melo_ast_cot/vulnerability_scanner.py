import json
import subprocess
import tempfile
from pathlib import Path


def _run_scanner(code: str, command: list) -> dict:
    with tempfile.NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:
        f.write(code)
        temp_path = Path(f.name)

    try:
        result = subprocess.run(command + [str(temp_path)], capture_output=True, text=True)
        return json.loads(result.stdout) if result.stdout else {}
    finally:
        temp_path.unlink()


def run_bandit(code: str) -> dict:
    return _run_scanner(code, ['bandit', '-f', 'json', '-ll'])


def run_semgrep(code: str) -> dict:
    return _run_scanner(code, ['semgrep', '--config', 'p/python', '--sarif'])


if __name__ == "__main__":
    test_code = "def run_command(cmd):\n    exec(cmd)"

    with tempfile.NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:
        f.write(test_code)
        temp_path = Path(f.name)

    result = subprocess.run(['bandit', '-f', 'json', str(temp_path)], capture_output=True, text=True)
    print("STDOUT:", result.stdout)
    print("STDERR:", result.stderr)
    temp_path.unlink()